# 变更日志

## 2026-01-15 - 核心交互方式调整

### 重大变更：签到 → 敲木鱼

**背景：** 将传统的签到方式改为更有禅意的敲木鱼交互，提升用户体验和趣味性。

### 核心变化

#### 1. 交互方式
- **之前**：每天只能签到一次
- **现在**：每天可以无限次敲木鱼
- **判定**：只要当天有敲击动作，就算活着

#### 2. 数据模型
- **新增**：`todayKnocks` - 今日敲击次数
- **新增**：`totalKnocks` - 总敲击次数
- **新增**：`merit` - 功德值（累计）
- **新增**：`KnockRecord` - 敲击记录
- **新增**：`DailyStats` - 每日统计
- **重命名**：`lastCheckIn` → `lastKnockTime`
- **移除**：`totalCheckIns`（改为 `totalKnocks`）

#### 3. 功德值系统
- 每次敲击 +1 功德值
- 功德值永久累积，不会减少
- 可用于后续功能（成就、排行榜等）

#### 4. 生命值系统
- 保持不变：初始 100，最大 100，最小 0
- **调整**：每日首次敲击 +10 HP（而非每次签到）
- 未敲击惩罚：每天 -10 HP

#### 5. 通知文案
- "签到成功" → "功德 +1"
- "你已阵亡" → "你已往生"
- "立即复活" → "立即超度"
- 增加禅意风格

#### 6. UI 组件
- `CheckInButton` → `WoodenFish`（木鱼组件）
- 显示今日敲击次数
- 显示功德值
- 活跃日历：颜色深浅表示敲击次数

### 文件变更

#### 更新的文件
- `openspec/changes/phase-1-mvp-local/spec.md` - 完整重写核心功能设计
- `openspec/changes/phase-1-mvp-local/tasks.md` - 更新任务清单
- `src/shared/types.ts` - 更新数据模型
- `src/shared/constants.ts` - 更新常量配置
- `openspec/project.md` - 更新项目概述
- `README.md` - 更新项目介绍

### 影响范围

#### 阶段 1（MVP 本地版）
- ✅ 数据模型已更新
- ✅ 类型定义已更新
- ✅ 常量配置已更新
- ✅ 设计文档已更新
- ✅ 任务清单已更新
- ⏳ 代码实现待开始

#### 阶段 2（游戏化升级）
- 需要调整：创意签到方式 → 木鱼音效和动画
- 保持不变：成就系统、挑战任务、主题系统

#### 阶段 3（社交功能）
- 需要调整：API 接口（签到 → 敲木鱼）
- 需要调整：数据库模型
- 保持不变：好友系统、排行榜、通知

### 下一步

1. **立即可做**：
   - 开始实现阶段 1 任务
   - 设计木鱼图形/按钮
   - 实现敲击交互

2. **后续优化**：
   - 添加木鱼音效（阶段 2）
   - 添加敲击动画（阶段 2）
   - 优化禅意风格 UI

### 技术债务

无。所有设计文档和类型定义已同步更新。

### 兼容性

- ✅ 向后兼容：新用户直接使用新模型
- ⚠️ 数据迁移：需要为老用户提供数据迁移（如果有）
  - `lastCheckIn` → `lastKnockTime`
  - `totalCheckIns` → `totalKnocks`
  - 初始化 `merit = 0`
  - 初始化 `todayKnocks = 0`

---

**更新人**：wenxy + AI 助手  
**审核状态**：待用户确认  
**实施状态**：设计完成，待实现
