# M3：可视化增强 - 任务清单

## 迭代 1.11：统计图表（1 天）

### 图表基础组件
- [ ] 1.11.1 创建图表工具函数
  - 创建 `src/shared/utils/chart-utils.ts`
  - 实现 `calculateChartScale(data, height)` - 计算 Y 轴缩放
  - 实现 `formatChartDate(timestamp)` - 格式化日期显示
  - 实现 `generateChartPoints(data, width, height)` - 生成坐标点

- [ ] 1.11.2 创建 LineChart 组件
  - 创建 `src/options/components/charts/LineChart.tsx`
  - 实现 SVG 折线图
  - 支持自定义颜色
  - 添加数据点圆圈
  - 添加 Tooltip（悬停显示数值）

- [ ] 1.11.3 创建 BarChart 组件
  - 创建 `src/options/components/charts/BarChart.tsx`
  - 实现 SVG 柱状图
  - 支持自定义颜色
  - 添加 Tooltip

- [ ] 1.11.4 创建 AreaChart 组件
  - 创建 `src/options/components/charts/AreaChart.tsx`
  - 实现 SVG 面积图
  - 使用渐变填充
  - 添加 Tooltip

### 图表数据准备
- [ ] 1.11.5 创建图表数据 Hook
  - 创建 `src/options/hooks/useChartData.ts`
  - 实现 `useConsecutiveDaysChart()` - 连续活跃趋势
  - 实现 `useHPChart()` - HP 变化曲线
  - 实现 `useKnocksChart()` - 每日敲击趋势
  - 实现 `useMeritChart()` - 功德值累计曲线

- [ ] 1.11.6 实现数据转换
  - 从 DailyStats 提取图表数据
  - 处理缺失数据（填充 0）
  - 限制数据范围（最近 30 天）

### StatsChart 组件
- [ ] 1.11.7 创建 StatsChart 组件
  - 创建 `src/options/components/StatsChart.tsx`
  - 实现标签页切换
  - 集成 4 种图表

- [ ] 1.11.8 实现图表切换
  - 添加图表类型选择器
  - 实现状态管理
  - 切换时加载对应数据

- [ ] 1.11.9 添加图表标题和说明
  - 显示图表标题
  - 添加 X/Y 轴标签
  - 添加图例

### 样式
- [ ] 1.11.10 实现图表样式
  - 创建 `src/options/components/charts/chart.css`
  - 设计图表容器样式
  - 设计标签页样式
  - 设计 Tooltip 样式
  - 确保响应式

### 集成
- [ ] 1.11.11 集成到 Options 页面
  - 在 Options 页面添加图表标签页
  - 调整布局

### 验收
- [ ] 1.11.12 测试图表功能
  - 所有图表正确显示
  - 数据准确
  - 可切换图表类型
  - Tooltip 正常工作
  - 响应式正常

---

## 迭代 1.12：样式和动画（1 天）

### 全局样式系统
- [ ] 1.12.1 创建 CSS 变量
  - 创建 `src/shared/styles/variables.css`
  - 定义颜色变量（禅意配色）
  - 定义间距变量
  - 定义字体变量
  - 定义圆角变量
  - 定义阴影变量
  - 定义过渡变量

- [ ] 1.12.2 创建全局样式
  - 创建 `src/shared/styles/global.css`
  - 重置默认样式
  - 定义全局字体
  - 定义全局布局
  - 引入 CSS 变量

- [ ] 1.12.3 创建动画样式
  - 创建 `src/shared/styles/animations.css`
  - 定义所有动画关键帧
  - 定义过渡效果

### 禅意风格设计
- [ ] 1.12.4 设计配色方案
  - 主色：绿色系 (#239a3b)
  - 背景：米白色 (#f5f5f0)
  - 文字：深灰色 (#333333)
  - 强调：木色、金色

- [ ] 1.12.5 优化组件样式
  - 更新 Popup 样式
  - 更新 Options 样式
  - 统一卡片样式
  - 统一按钮样式
  - 添加留白和间距

### 动画效果
- [ ] 1.12.6 实现木鱼点击动画
  - 添加点击缩放效果
  - 添加敲击动画（scale + rotate）
  - 使用 CSS transform

- [ ] 1.12.7 实现 HP 变化动画
  - HP 条宽度平滑过渡
  - HP 颜色平滑过渡
  - HP 数值脉冲动画

- [ ] 1.12.8 实现功德值增加动画
  - 数值变化时高亮
  - 添加 +1 浮动动画
  - 使用 CSS animation

- [ ] 1.12.9 实现页面过渡动画
  - 添加淡入淡出效果
  - 标签页切换动画
  - 使用 CSS transition

- [ ] 1.12.10 实现加载动画
  - 创建 Loading 组件
  - 实现简单的旋转动画
  - 应用到数据加载场景

### 响应式设计
- [ ] 1.12.11 优化 Popup 响应式
  - 固定宽度 360px
  - 适配不同高度
  - 确保内容不溢出

- [ ] 1.12.12 优化 Options 响应式
  - 最大宽度 1200px
  - 移动端适配（< 768px）
  - 调整网格布局
  - 调整图表大小

### 图标和图片
- [ ] 1.12.13 添加图标
  - 使用 Emoji 或 SVG 图标
  - 木鱼图标 🪵
  - 功德图标 🙏
  - HP 图标 ❤️
  - 连续图标 🔥

### 集成和测试
- [ ] 1.12.14 集成全局样式
  - 在 Popup 中引入全局样式
  - 在 Options 中引入全局样式
  - 确保样式不冲突

- [ ] 1.12.15 测试动画效果
  - 测试所有动画
  - 确保流畅自然
  - 检查性能

- [ ] 1.12.16 测试响应式
  - 测试不同屏幕尺寸
  - 测试 Popup 和 Options
  - 确保布局正常

### 优化
- [ ] 1.12.17 性能优化
  - 优化 CSS 选择器
  - 减少重绘和回流
  - 使用 will-change 提示

- [ ] 1.12.18 代码优化
  - 提取公共样式
  - 移除未使用的样式
  - 压缩 CSS

---

## 完成标准

### 必须完成
- [ ] 所有迭代任务完成
- [ ] 图表正确显示
- [ ] 样式统一美观
- [ ] 动画流畅自然
- [ ] 响应式布局正常

### 验收检查
- [ ] 4 种图表都能正常显示
- [ ] 图表数据准确
- [ ] 全局样式应用正确
- [ ] 禅意风格明显
- [ ] 所有动画正常工作
- [ ] Popup 和 Options 响应式正常
- [ ] 无 Console 错误
- [ ] 性能良好

## 时间安排

**Day 1：**
- 上午：迭代 1.11（统计图表）- 图表组件
- 下午：迭代 1.11（统计图表）- 数据和集成

**Day 2：**
- 上午：迭代 1.12（样式和动画）- 全局样式
- 下午：迭代 1.12（样式和动画）- 动画和响应式

## 注意事项

1. **图表性能**：限制数据点数量，使用简单的 SVG
2. **动画性能**：优先使用 CSS 动画，避免 JS 动画
3. **样式隔离**：使用 CSS Modules 或 BEM 命名
4. **禅意风格**：保持简洁、留白、自然
5. **响应式**：确保在不同屏幕尺寸下都正常

## 下一步

完成 M3 后：
1. 全面测试所有功能
2. 优化性能
3. 准备进入 M4：测试和发布
