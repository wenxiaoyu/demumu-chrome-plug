# M7 提案变更记录

## 变更日期：2026-01-20

## 变更内容

### 简化登录提示逻辑

**原方案：**
- 添加紧急联系人时提示
- 使用 3 天后提示
- 尝试发送邮件时提示

**新方案：**
- **仅在添加紧急联系人时提示**
- 不在其他地方主动提示登录
- 未登录时邮件发送静默失败（记录日志）

### 变更原因

用户反馈希望简化登录提示，避免过度打扰。

### 影响范围

#### 1. 时间估算
- **原计划**：3-4 天
- **新计划**：3 天
- **减少**：0.2 天（登录提示逻辑简化）

#### 2. 任务变更

**删除的任务：**
- ~~5.1 实现登录提示逻辑~~（不需要复杂的提示判断）
- ~~5.3 使用 3 天后提示~~（不再提示）

**保留的任务：**
- 5.1 添加紧急联系人时提示（唯一提示时机）
- 5.2 发送邮件时检查登录（静默失败）

#### 3. 功能变更

**用户体验：**
- 更简洁：只在真正需要时提示
- 不打扰：不会在使用过程中弹出提示
- 更清晰：用户明确知道登录是为了发送邮件

**技术实现：**
- 不需要 `login-prompt.ts` 工具文件
- 不需要跟踪使用天数
- 不需要记录提示历史
- 代码更简单

### 更新的文档

- ✅ `spec.md` - 更新登录提示时机说明
- ✅ `tasks.md` - 简化任务 5（登录提示和引导）
- ✅ `README.md` - 更新功能说明和时间估算

### 验收标准变更

**新增：**
- [ ] 添加紧急联系人时提示登录（未登录时）
- [ ] 点击"稍后再说"可以继续添加联系人
- [ ] 未登录时邮件发送被阻止（静默失败）

**删除：**
- ~~未登录时在合适时机提示登录~~
- ~~尝试发送邮件时检查登录状态~~（改为静默失败）

## 总结

这次变更使登录提示更加简洁和克制，符合"本地优先"的设计原则。用户可以完全在本地使用所有功能，只有在需要云端功能（邮件通知）时才会被提示登录。

