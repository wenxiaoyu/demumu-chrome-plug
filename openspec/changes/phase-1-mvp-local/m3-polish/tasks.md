# M3：优化和完善 - 任务清单

## 迭代 1.11：功能完善（0.5 天）

### 全局样式系统
- [ ] 1.11.1 创建 CSS 变量文件
  - 创建 `src/shared/styles/variables.css`
  - 定义颜色变量
  - 定义间距变量
  - 定义圆角变量
  - 定义阴影变量
  - 定义过渡变量

- [ ] 1.11.2 创建全局样式文件
  - 创建 `src/shared/styles/global.css`
  - 引入 CSS 变量
  - 定义全局重置样式
  - 定义通用工具类

- [ ] 1.11.3 应用 CSS 变量
  - 在 Popup 组件中应用
  - 在 Options 组件中应用
  - 在 StatsPage 组件中应用
  - 替换硬编码的颜色和尺寸

### 错误处理优化
- [ ] 1.11.4 创建错误组件
  - 创建 `src/shared/components/ErrorMessage.tsx`
  - 实现错误图标
  - 实现错误文案
  - 实现重试按钮

- [ ] 1.11.5 应用错误处理
  - 在 StatsPage 中应用
  - 在 useKnock 中应用
  - 统一错误提示样式

### 加载状态优化
- [ ] 1.11.6 创建加载组件
  - 创建 `src/shared/components/LoadingSpinner.tsx`
  - 实现旋转动画
  - 实现加载文案

- [ ] 1.11.7 应用加载状态
  - 在 StatsPage 中应用
  - 在 Popup 中应用
  - 统一加载样式

### 首次使用引导
- [ ] 1.11.8 创建引导检测 Hook
  - 创建 `src/shared/hooks/useFirstTimeUser.ts`
  - 检测是否首次使用
  - 检测是否有敲击记录

- [ ] 1.11.9 创建欢迎引导组件
  - 创建 `src/popup/components/WelcomeGuide.tsx`
  - 显示欢迎信息
  - 显示使用说明
  - 添加开始按钮

- [ ] 1.11.10 集成引导功能
  - 在 Popup 中集成
  - 首次使用时显示
  - 点击开始后隐藏

---

## 迭代 1.12：体验优化（0.5 天）

### 格式化工具
- [ ] 1.12.1 创建格式化工具文件
  - 创建 `src/shared/utils/format.ts`
  - 实现 `formatNumber()` - 数字格式化
  - 实现 `formatRelativeTime()` - 相对时间
  - 实现 `formatDuration()` - 时长格式化

- [ ] 1.12.2 应用格式化工具
  - 在所有数字显示处应用
  - 在日期显示处应用
  - 统一格式化规则

### 空状态优化
- [ ] 1.12.3 创建空状态组件
  - 创建 `src/shared/components/EmptyState.tsx`
  - 实现空状态图标
  - 实现空状态文案
  - 实现操作按钮

- [ ] 1.12.4 应用空状态
  - 在 StatsPage 中应用（无数据时）
  - 在 Calendar 中应用（无记录时）
  - 统一空状态样式

### 响应式优化
- [ ] 1.12.5 检查 Popup 响应式
  - 检查不同高度下的显示
  - 优化内容溢出处理
  - 确保关键信息可见

- [ ] 1.12.6 检查 Options 响应式
  - 检查移动端显示（< 768px）
  - 优化网格布局
  - 优化图表大小
  - 确保所有功能可用

### 性能优化
- [ ] 1.12.7 优化组件渲染
  - 使用 React.memo 包装纯组件
  - 使用 useMemo 缓存计算结果
  - 使用 useCallback 缓存函数

- [ ] 1.12.8 优化数据加载
  - 减少不必要的存储读取
  - 批量更新数据
  - 添加数据缓存

### 细节打磨
- [ ] 1.12.9 统一样式
  - 统一所有按钮样式
  - 统一所有卡片样式
  - 统一所有间距
  - 统一所有圆角

- [ ] 1.12.10 检查文案
  - 检查所有提示文案
  - 检查所有按钮文案
  - 确保文案友好易懂

- [ ] 1.12.11 检查图标
  - 检查所有 Emoji 图标
  - 确保图标语义正确
  - 统一图标大小

- [ ] 1.12.12 优化动画
  - 检查所有动画时长
  - 确保动画流畅自然
  - 添加适当的过渡效果

---

## 完成标准

### 必须完成
- [ ] 所有迭代任务完成
- [ ] CSS 变量系统应用
- [ ] 错误处理统一
- [ ] 加载状态优化
- [ ] 首次使用引导完成
- [ ] 格式化工具应用
- [ ] 空状态优化
- [ ] 响应式检查完成
- [ ] 性能优化完成
- [ ] 细节打磨完成

### 验收检查
- [ ] 样式统一美观
- [ ] 错误提示友好
- [ ] 加载体验流畅
- [ ] 首次使用引导清晰
- [ ] 数字格式化统一
- [ ] 空状态显示正常
- [ ] 响应式正常
- [ ] 性能良好
- [ ] 无 Console 错误
- [ ] 构建成功

## 时间安排

**Day 1：**
- 上午：迭代 1.11（功能完善）
- 下午：迭代 1.12（体验优化）

## 注意事项

1. **样式重构**：逐步替换，充分测试，避免影响现有样式
2. **性能优化**：谨慎优化，保持简单，避免过度优化
3. **用户体验**：从用户角度出发，关注细节
4. **代码质量**：保持代码整洁，添加必要注释

## 下一步

完成 M3 后：
1. 进入 M4：测试和发布
2. 全面测试所有功能
3. 修复发现的 bug
4. 完善文档
5. 准备发布
