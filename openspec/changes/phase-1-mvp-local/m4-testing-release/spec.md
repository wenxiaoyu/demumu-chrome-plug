# M4：测试和发布（迭代 1.13 - 1.14）

## 目标

全面测试 MVP 功能，修复 bug，完善文档，准备发布。

**里程碑价值：** 稳定可发布的 MVP 版本。

## 时间估算

**总计：1 天**

- 迭代 1.13：测试和修复（0.5 天）
- 迭代 1.14：文档和发布（0.5 天）

## 范围

### 包含
- ✅ 功能测试
- ✅ Bug 修复
- ✅ 代码质量检查
- ✅ 文档完善
- ✅ 发布准备

### 不包含
- ❌ 自动化测试（单元测试、E2E 测试）
- ❌ 性能监控系统
- ❌ 用户反馈收集系统
- ❌ Chrome Web Store 发布（后续单独进行）

## 详细设计

### 迭代 1.13：测试和修复

#### 功能测试清单

**1. 核心功能测试**

| 功能 | 测试场景 | 预期结果 | 状态 |
|------|---------|---------|------|
| 首次安装 | 安装插件 | 初始化用户数据，HP=100，功德=0 | [ ] |
| 敲木鱼 | 点击木鱼 | todayKnocks +1, totalKnocks +1, merit +1 | [ ] |
| 首次敲击 | 今日首次敲击 | HP +10 | [ ] |
| 再次敲击 | 今日再次敲击 | HP 不变 | [ ] |
| 跨天重置 | 跨天后敲击 | todayKnocks 重置为 1 | [ ] |
| 连续活跃 | 连续两天敲击 | consecutiveDays +1 | [ ] |
| 断活 | 间隔多天敲击 | consecutiveDays 重置为 1 | [ ] |
| HP 扣除 | 一天不敲击 | HP -10 | [ ] |
| HP 上限 | HP 达到 100 | 不超过 100 | [ ] |
| HP 下限 | HP 降到 0 | status = 'dead' | [ ] |

**2. 数据统计测试**

| 功能 | 测试场景 | 预期结果 | 状态 |
|------|---------|---------|------|
| 敲击记录 | 每次敲击 | 保存完整记录 | [ ] |
| 每日统计 | 每次敲击 | 更新当日统计 | [ ] |
| 活跃日历 | 打开 Options | 显示当月日历 | [ ] |
| 日历颜色 | 不同敲击次数 | 显示不同颜色 | [ ] |
| 月份切换 | 点击上一月/下一月 | 正确切换月份 | [ ] |
| 关键指标 | 打开 Options | 显示总功德、连续天数、存活天数 | [ ] |

**3. 通知测试**

| 功能 | 测试场景 | 预期结果 | 状态 |
|------|---------|---------|------|
| 死亡通知 | HP = 0 | 显示死亡通知 | [ ] |
| 警告通知 | HP < 30 | 显示警告通知 | [ ] |
| 首次敲击通知 | 今日首次敲击 | 显示功德通知 | [ ] |

**4. UI/UX 测试**

| 功能 | 测试场景 | 预期结果 | 状态 |
|------|---------|---------|------|
| 木鱼动画 | 点击木鱼 | 棍子敲击、涟漪、光晕动画 | [ ] |
| 数字动画 | 数值变化 | 数字弹跳动画 | [ ] |
| 加载状态 | 数据加载中 | 显示加载提示 | [ ] |
| 错误状态 | 数据加载失败 | 显示错误提示 | [ ] |
| 空状态 | 无数据 | 显示空状态提示 | [ ] |
| 响应式 | 不同屏幕尺寸 | 布局正常 | [ ] |

#### 边界测试清单

| 场景 | 测试内容 | 预期结果 | 状态 |
|------|---------|---------|------|
| 首次使用 | 无数据时 | 正常初始化，显示引导 | [ ] |
| 大量敲击 | 敲击 100+ 次 | 功德值正确显示，性能正常 | [ ] |
| 长时间未使用 | 30+ 天未敲击 | HP 正确计算，连续天数重置 | [ ] |
| HP 归零 | HP = 0 | 显示死亡状态，可继续敲击 | [ ] |
| 跨年跨月 | 跨年/跨月时 | 日期计算正确，日历显示正确 | [ ] |

#### 代码质量检查

**1. TypeScript 检查**
```bash
npm run type-check
```
- [ ] 无类型错误
- [ ] 类型定义完整

**2. 构建检查**
```bash
npm run build
```
- [ ] 构建成功
- [ ] 无错误和警告
- [ ] 文件大小合理

**3. 代码审查**
- [ ] 移除所有 console.log
- [ ] 移除未使用的代码
- [ ] 移除 TODO 注释
- [ ] 代码注释完整

### 迭代 1.14：文档和发布

#### 文档完善

**1. README.md 更新**

内容：
```markdown
# 还活着吗 - Chrome 扩展

一个有趣的生存挑战插件，通过敲木鱼保持"活跃"状态。

## 功能特性

- 🪵 敲木鱼获得功德
- ❤️ HP 系统：每天不敲击会扣 HP
- 🔥 连续活跃天数统计
- 📊 数据统计和可视化
- 🎨 禅意风格设计

## 安装方法

1. 下载最新版本的 zip 文件
2. 解压到本地目录
3. 打开 Chrome 浏览器，进入扩展管理页面（chrome://extensions/）
4. 开启"开发者模式"
5. 点击"加载已解压的扩展程序"
6. 选择解压后的目录

## 使用说明

1. 点击浏览器工具栏的木鱼图标
2. 点击木鱼开始敲击
3. 每天至少敲击一次保持活跃
4. 右键点击图标 → 选项，查看详细统计

## 技术栈

- TypeScript
- React
- Vite
- Chrome Extension Manifest V3

## 开发

\`\`\`bash
# 安装依赖
npm install

# 开发模式
npm run dev

# 构建
npm run build
\`\`\`

## 许可证

MIT
```

**2. CHANGELOG.md 创建**

内容：
```markdown
# 更新日志

## [0.2.0] - 2026-01-17

### 新增
- 数据统计功能
  - 敲击记录历史
  - 每日统计
  - 活跃日历热力图
  - 关键指标展示
- Options 页面
- 首次使用引导
- 错误处理优化
- 加载状态优化

### 改进
- 优化木鱼敲击动画
- 优化数字显示格式
- 优化响应式布局
- 统一全局样式

### 修复
- 修复跨天逻辑问题
- 修复 HP 计算问题
- 修复日历显示问题

## [0.1.0] - 2026-01-15

### 新增
- 基础功能
  - 敲木鱼
  - HP 系统
  - 功德值系统
  - 连续活跃天数
- 通知系统
- Badge 显示
- 禅意风格 UI
```

**3. 用户指南（可选）**

创建 `docs/USER_GUIDE.md`：
- 快速开始
- 功能说明
- 常见问题

#### 截图准备

**需要的截图**：
1. Popup 界面（木鱼、HP、功德值）
2. Options 页面（关键指标 + 日历）
3. 通知示例（可选）

**截图规格**：
- 格式：PNG
- 尺寸：适当缩放，保持清晰
- 存放位置：`docs/screenshots/`

#### 发布准备

**1. 版本号更新**

更新 `package.json` 和 `manifest.json`：
```json
{
  "version": "0.2.0"
}
```

**2. 构建生产版本**
```bash
npm run build
```

检查：
- [ ] 构建成功
- [ ] dist 目录生成
- [ ] 所有文件正常

**3. 手动测试打包版本**
- [ ] 加载到 Chrome
- [ ] 所有功能正常
- [ ] 无 Console 错误

**4. 创建 Git 标签**
```bash
git add .
git commit -m "Release v0.2.0: MVP 本地版完成"
git tag -a v0.2.0 -m "Release v0.2.0"
git push origin main
git push origin v0.2.0
```

**5. 打包发布文件**
```bash
cd dist
zip -r ../demumu-chrome-extension-v0.2.0.zip .
```

## 测试清单

### 核心功能（必测）
- [ ] 敲木鱼功能
- [ ] HP 系统
- [ ] 功德值累积
- [ ] 连续活跃天数
- [ ] 跨天逻辑
- [ ] 通知系统

### 数据统计（必测）
- [ ] 敲击记录保存
- [ ] 每日统计更新
- [ ] 活跃日历显示
- [ ] 关键指标显示
- [ ] 月份切换

### UI/UX（必测）
- [ ] 木鱼动画
- [ ] 数字动画
- [ ] 加载状态
- [ ] 错误状态
- [ ] 响应式布局

### 边界情况（建议测）
- [ ] 首次使用
- [ ] 大量敲击
- [ ] 长时间未使用
- [ ] HP 归零
- [ ] 跨年跨月

### 代码质量（必检）
- [ ] TypeScript 检查通过
- [ ] 构建成功
- [ ] 无 console.log
- [ ] 代码注释完整

### 文档（必完成）
- [ ] README.md 更新
- [ ] CHANGELOG.md 创建
- [ ] 截图准备

### 发布（必完成）
- [ ] 版本号更新
- [ ] 构建生产版本
- [ ] 手动测试
- [ ] 创建 Git 标签
- [ ] 打包发布文件

## 验收标准

### 功能验收
- [ ] 所有核心功能正常
- [ ] 所有数据统计功能正常
- [ ] 无明显 bug

### 代码验收
- [ ] TypeScript 类型检查通过
- [ ] 构建成功无错误
- [ ] 代码质量良好

### 文档验收
- [ ] README.md 完整
- [ ] CHANGELOG.md 完整
- [ ] 截图清晰

### 发布验收
- [ ] 可以成功构建
- [ ] 可以成功打包
- [ ] 可以加载到 Chrome
- [ ] 所有功能正常工作

## 依赖

- M1：核心功能完成
- M2：数据统计完成
- M3：优化和完善完成

## 风险

### 技术风险
1. **测试不全面**
   - 风险：可能遗漏 bug
   - 应对：使用测试清单，逐项检查

2. **兼容性问题**
   - 风险：不同 Chrome 版本可能有差异
   - 应对：在最新版本测试即可，后续根据反馈调整

## 下一步

完成 M4 后：
1. 发布 v0.2.0 版本到 GitHub
2. 准备 Chrome Web Store 发布材料
3. 收集用户反馈
4. 规划下一阶段功能

## 成功标准

- [ ] 所有测试通过
- [ ] 文档完整
- [ ] 成功发布
- [ ] 可以正常使用

**MVP 本地版完成！🎉**

## 范围

### 包含
- ✅ 功能测试
- ✅ 边界测试
- ✅ 性能优化
- ✅ Bug 修复
- ✅ 代码质量检查
- ✅ 文档完善
- ✅ 发布准备

### 不包含
- ❌ 自动化测试（单元测试、E2E 测试）
- ❌ 性能监控
- ❌ 用户反馈收集

## 详细设计

### 迭代 1.13：测试和优化

#### 功能测试

**1. 核心功能测试**

测试场景：
- 首次安装
  - [ ] 初始化用户数据
  - [ ] 初始 HP = 100
  - [ ] 初始功德 = 0
  - [ ] 初始连续天数 = 0

- 敲木鱼
  - [ ] 点击木鱼，todayKnocks +1
  - [ ] 点击木鱼，totalKnocks +1
  - [ ] 点击木鱼，merit +1
  - [ ] 今日首次敲击，HP +10
  - [ ] 今日再次敲击，HP 不变
  - [ ] 显示更新正确

- 跨天逻辑
  - [ ] 跨天后 todayKnocks 重置为 0
  - [ ] 连续敲击，consecutiveDays +1
  - [ ] 断活后，consecutiveDays 重置为 1
  - [ ] 未敲击，HP -10/天

- HP 系统
  - [ ] HP 不超过 100
  - [ ] HP 不低于 0
  - [ ] HP = 0 时 status = 'dead'
  - [ ] HP > 0 时 status = 'alive'
  - [ ] HP 颜色正确变化

**2. 数据统计测试**

测试场景：
- 敲击记录
  - [ ] 每次敲击保存记录
  - [ ] 记录包含完整信息
  - [ ] 可查询历史记录

- 每日统计
  - [ ] 每天有独立统计
  - [ ] 统计数据准确
  - [ ] 可查询历史统计

- 活跃日历
  - [ ] 显示当月日历
  - [ ] 颜色深浅正确
  - [ ] 可切换月份
  - [ ] 今天有标记

- 数据总览
  - [ ] 所有指标显示
  - [ ] 数据计算准确

**3. 可视化测试**

测试场景：
- 统计图表
  - [ ] 4 种图表都能显示
  - [ ] 图表数据准确
  - [ ] 可切换图表类型
  - [ ] Tooltip 正常

- 样式和动画
  - [ ] 样式统一
  - [ ] 动画流畅
  - [ ] 响应式正常

**4. 通知测试**

测试场景：
- 死亡通知
  - [ ] HP = 0 时显示通知
  - [ ] 通知文案正确

- 警告通知
  - [ ] HP < 30 时显示通知
  - [ ] 通知文案正确

- 首次敲击通知
  - [ ] 今日首次敲击显示通知
  - [ ] 通知文案正确

**5. 后台服务测试**

测试场景：
- 定时检查
  - [ ] 每小时自动检查
  - [ ] 浏览器启动时检查
  - [ ] 插件安装时初始化

- Badge 更新
  - [ ] Badge 显示 HP
  - [ ] Badge 颜色正确

#### 边界测试

**1. 首次使用**
- [ ] 无数据时正常初始化
- [ ] 显示欢迎信息
- [ ] 引导用户敲击

**2. 大量敲击**
- [ ] 敲击 1000+ 次
- [ ] 功德值显示正常
- [ ] 性能不受影响

**3. 长时间未使用**
- [ ] 30+ 天未敲击
- [ ] HP 正确计算（可能为负）
- [ ] 连续天数重置

**4. HP 归零**
- [ ] HP = 0 时显示死亡状态
- [ ] 可以继续敲击
- [ ] HP 恢复正常

**5. 数据清除**
- [ ] 清除数据后重新初始化
- [ ] 不影响插件运行

**6. 跨年跨月**
- [ ] 跨年时日期计算正确
- [ ] 跨月时日历显示正确

#### 性能优化

**1. 存储优化**
- [ ] 减少不必要的读写
- [ ] 批量更新数据
- [ ] 限制历史记录数量

**2. 渲染优化**
- [ ] 避免不必要的重渲染
- [ ] 使用 React.memo
- [ ] 使用 useMemo/useCallback

**3. 图表优化**
- [ ] 限制数据点数量
- [ ] 使用简单的 SVG
- [ ] 避免复杂计算

**4. 动画优化**
- [ ] 使用 CSS 动画
- [ ] 避免 JS 动画
- [ ] 使用 will-change

**5. 内存优化**
- [ ] 检查内存泄漏
- [ ] 清理事件监听
- [ ] 清理定时器

#### 代码质量

**1. TypeScript 检查**
```bash
npm run type-check
```
- [ ] 无类型错误
- [ ] 类型定义完整

**2. ESLint 检查**
```bash
npm run lint
```
- [ ] 无 lint 错误
- [ ] 代码风格统一

**3. 代码格式化**
```bash
npm run format
```
- [ ] 代码格式统一
- [ ] 使用 Prettier

**4. 代码注释**
- [ ] 关键函数有注释
- [ ] 复杂逻辑有说明
- [ ] 类型定义有注释

**5. 代码审查**
- [ ] 移除 console.log
- [ ] 移除未使用的代码
- [ ] 移除 TODO 注释

### 迭代 1.14：文档和发布

#### 文档完善

**1. README.md**

更新内容：
- 项目介绍
- 功能特性
- 安装方法
- 使用说明
- 截图展示
- 技术栈
- 开发指南
- 许可证

**2. CHANGELOG.md**

记录内容：
- v0.2.0 版本更新
- 新增功能
- 改进内容
- Bug 修复

**3. 使用文档**

创建 `docs/USER_GUIDE.md`：
- 快速开始
- 功能说明
- 常见问题
- 故障排除

**4. 开发文档**

创建 `docs/DEVELOPMENT.md`：
- 项目结构
- 技术架构
- 开发流程
- 构建部署

#### 截图准备

**1. Popup 截图**
- 木鱼界面
- HP 显示
- 功德值显示
- 连续天数显示

**2. Options 截图**
- 活跃日历
- 数据总览
- 统计图表

**3. 通知截图**
- 死亡通知
- 警告通知
- 首次敲击通知

#### 发布准备

**1. 构建生产版本**
```bash
npm run build
```
- [ ] 构建成功
- [ ] 无错误和警告
- [ ] 文件大小合理

**2. 测试打包**
```bash
npm run package
```
- [ ] 打包成功
- [ ] 生成 zip 文件
- [ ] 文件结构正确

**3. 手动测试打包版本**
- [ ] 加载到 Chrome
- [ ] 所有功能正常
- [ ] 无 Console 错误

**4. 创建 Release Notes**

内容：
- 版本号：v0.2.0
- 发布日期
- 新增功能
- 改进内容
- 已知问题

**5. 创建 Git 标签**
```bash
git tag -a v0.2.0 -m "Release v0.2.0: MVP 本地版"
git push origin v0.2.0
```

**6. 创建 GitHub Release**
- 上传 zip 文件
- 添加 Release Notes
- 添加截图

## 测试清单

### 功能测试清单
- [ ] 敲木鱼功能
- [ ] 功德值累积
- [ ] 今日/总敲击统计
- [ ] HP 系统
- [ ] 连续活跃天数
- [ ] 状态检测
- [ ] 通知系统
- [ ] 敲击记录
- [ ] 每日统计
- [ ] 活跃日历
- [ ] 数据总览
- [ ] 统计图表
- [ ] 样式和动画

### 边界测试清单
- [ ] 首次使用
- [ ] 大量敲击（1000+ 次）
- [ ] 长时间未使用（30+ 天）
- [ ] HP 归零
- [ ] 数据清除
- [ ] 跨年跨月

### 性能测试清单
- [ ] 存储读写性能
- [ ] 渲染性能
- [ ] 图表性能
- [ ] 动画性能
- [ ] 内存使用

### 兼容性测试清单
- [ ] Chrome 最新版
- [ ] Chrome 旧版（至少 2 个版本）
- [ ] Edge 最新版
- [ ] 不同操作系统（Windows/Mac/Linux）

### 代码质量清单
- [ ] TypeScript 类型检查通过
- [ ] ESLint 检查通过
- [ ] 代码格式化完成
- [ ] 代码注释完整
- [ ] 无 console.log
- [ ] 无未使用的代码

### 文档清单
- [ ] README.md 更新
- [ ] CHANGELOG.md 创建
- [ ] USER_GUIDE.md 创建
- [ ] DEVELOPMENT.md 创建
- [ ] 截图准备完成

### 发布清单
- [ ] 构建生产版本
- [ ] 测试打包版本
- [ ] 创建 Release Notes
- [ ] 创建 Git 标签
- [ ] 创建 GitHub Release
- [ ] 上传 zip 文件

## 验收标准

### 功能验收
- [ ] 所有核心功能正常
- [ ] 所有边界情况处理正确
- [ ] 无明显 bug

### 性能验收
- [ ] 响应速度快（< 100ms）
- [ ] 内存使用合理（< 50MB）
- [ ] 无内存泄漏

### 代码验收
- [ ] TypeScript 类型检查通过
- [ ] ESLint 检查通过
- [ ] 代码质量良好

### 文档验收
- [ ] 文档完整
- [ ] 截图清晰
- [ ] 说明准确

### 发布验收
- [ ] 可以成功构建
- [ ] 可以成功打包
- [ ] 可以加载到 Chrome

## 依赖

- M1：核心功能完成
- M2：数据统计完成
- M3：可视化完成

## 风险

### 技术风险
1. **性能问题**
   - 风险：大量数据可能影响性能
   - 应对：限制数据量，优化算法

2. **兼容性问题**
   - 风险：不同 Chrome 版本可能有差异
   - 应对：测试多个版本

3. **Bug 遗漏**
   - 风险：测试不全面可能遗漏 bug
   - 应对：制定详细测试清单

## 下一步

完成 M4 后：
1. 发布 v0.2.0 版本
2. 收集用户反馈
3. 规划阶段 2：数据导入导出
4. 规划阶段 3：云端同步

## 成功标准

- [ ] 所有测试通过
- [ ] 性能达标
- [ ] 文档完整
- [ ] 成功发布
- [ ] 用户可以正常使用

**MVP 本地版完成！🎉**
