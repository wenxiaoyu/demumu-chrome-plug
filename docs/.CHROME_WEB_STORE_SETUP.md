# Chrome Web Store 自动发布设置指南

本指南将帮助你配置自动发布到 Chrome Web Store 的功能。

## 前提条件

1. Chrome Web Store 开发者账号（需支付 $5 一次性注册费）
2. Google 账号必须启用两步验证（2FA）
3. 已在 Chrome Web Store 上传过至少一次你的扩展（获取 Extension ID）

### 启用 Google 两步验证

Chrome Web Store 要求开发者账号必须启用两步验证才能上传扩展。

**启用步骤：**

1. **访问 Google 账号安全设置**
   - 打开 https://myaccount.google.com/security
   - 使用你的开发者账号登录

2. **找到两步验证选项**
   - 在"登录 Google"部分找到"两步验证"
   - 点击"两步验证"

3. **开始设置**
   - 点击"开始使用"
   - 输入密码确认身份

4. **选择验证方式**（推荐顺序）：

   **方式 1: 手机号码（最常用）**
   - 输入你的手机号码
   - 选择接收短信或语音来电
   - 输入收到的验证码
   - 完成设置

   **方式 2: Google 身份验证器 App（更安全）**
   - 在手机上安装 Google Authenticator
   - 扫描屏幕上的二维码
   - 输入 App 显示的 6 位数字
   - 完成设置

   **方式 3: 备用手机号码**
   - 添加备用手机号码
   - 用于主手机无法使用时

5. **保存备用验证码**
   - 设置完成后，点击"获取备用验证码"
   - 下载或打印这些验证码
   - 妥善保存，用于紧急情况

6. **验证设置成功**
   - 返回 https://myaccount.google.com/security
   - 确认"两步验证"显示为"已启用"

**重要提示：**

- ⚠️ 启用两步验证后，每次登录都需要输入验证码
- ⚠️ 务必保存备用验证码，以防手机丢失
- ⚠️ 可以添加多个验证方式作为备份
- ⚠️ 启用后立即生效，可以上传扩展了

### 中国用户支付开发者注册费的解决方案

Chrome Web Store 要求支付 $5 注册费，但中国用户可能遇到信用卡支付问题。以下是几种解决方案：

**方案 1: 使用支持外币支付的信用卡（最推荐）**

- Visa 或 Mastercard 标识的信用卡
- 确保开通了境外支付功能（致电银行客服开通）
- 推荐银行：
  - 招商银行全币种信用卡（Young 卡、经典卡）
  - 中信银行全币种信用卡
  - 工商银行多币种信用卡
  - 建设银行 VISA/Mastercard 信用卡
- 优点：稳定可靠，一次办理长期使用
- 申请时间：7-15 天

**方案 2: 使用 PayPal（推荐）**

- 注册 PayPal 账号：https://www.paypal.com
- 绑定银联储蓄卡或信用卡
- 在 Google 支付设置中添加 PayPal 作为支付方式
- PayPal 会自动处理货币转换
- 优点：支持储蓄卡，无需信用卡
- 注意：首次使用可能需要验证身份

**方案 3: 使用虚拟信用卡服务**

⚠️ **警告**：虚拟卡平台变化快，很多已停止服务或有限制。以下信息仅供参考：

可尝试的平台：

- **Nobepay**（https://www.nobepay.com）- 支持支付宝充值，但 Google 接受度不稳定
- 其他平台如 Dupay、Fomepay 等已停止服务或无法访问

**不推荐虚拟卡的原因：**

- 平台不稳定，经常停止服务
- Google 可能拒绝虚拟卡支付
- 需要额外的开卡费和月费
- 实名认证流程复杂

**方案 4: 请朋友代付（最简单）**

- 如果有海外朋友或同事，可以请他们代付
- 之后通过支付宝、微信等方式转账给对方
- 优点：最快速、最可靠
- 成本：仅 $5 + 汇率差

**方案 5: 使用淘宝代付服务**

- 在淘宝搜索"Chrome 开发者账号代付"或"Google 支付代付"
- 选择信誉好的商家
- 成本：约 ¥50-80（包含服务费）
- 优点：快速、无需自己办卡
- 注意：选择评价好的商家，避免被骗

**淘宝代付详细操作步骤：**

1. **搜索商家**
   - 打开淘宝 App 或网页版
   - 搜索关键词：
     - "Chrome 开发者账号"
     - "Chrome Web Store 注册"
     - "Google 开发者账号代付"
     - "谷歌开发者注册"

2. **选择可靠商家**
   - 查看店铺评分（建议 4.8 分以上）
   - 查看成交量（建议 100+ 笔）
   - 仔细阅读买家评价
   - 查看商家是否提供售后保障
   - 避免价格过低的商家（可能是骗子）

3. **咨询商家**
   - 联系客服确认服务内容
   - 询问需要提供什么信息
   - 确认支付流程和时间
   - 询问是否包含后续问题处理

4. **准备信息**
   商家通常需要你提供：
   - Google 账号邮箱（用于注册开发者账号）
   - 可能需要临时登录权限（建议使用临时密码）
   - 开发者信息（姓名、地址等）

5. **下单并支付**
   - 拍下商品
   - 通过淘宝支付（不要私下转账）
   - 等待商家操作

6. **商家代付流程**
   - 商家会使用他们的支付方式完成 $5 注册费
   - 通常 10-30 分钟完成
   - 完成后你的账号会显示为已注册开发者

7. **验证完成**
   - 登录 [Chrome Web Store Developer Dashboard](https://chrome.google.com/webstore/devconsole)
   - 确认可以看到开发者控制台
   - 确认可以上传扩展
   - 确认后在淘宝确认收货

**安全注意事项：**

- ⚠️ 使用淘宝担保交易，不要私下转账
- ⚠️ 如需提供账号密码，建议：
  - 先修改为临时密码
  - 完成后立即修改回来
  - 开启 Google 两步验证
- ⚠️ 不要提供信用卡、身份证等敏感信息
- ⚠️ 保留聊天记录和交易凭证
- ⚠️ 如遇到问题，可以申请淘宝介入

**常见问题：**

- **需要多久？** 通常 10-30 分钟，最长不超过 24 小时
- **安全吗？** 使用淘宝担保交易相对安全，但要选择信誉好的商家
- **会不会被封号？** 正规代付不会，但要确保商家使用合法支付方式
- **后续还能用吗？** 可以，注册费是一次性的，之后可以自己管理

**替代方案：**
如果不想使用淘宝代付，也可以在以下平台寻找：

- 闲鱼（阿里旗下二手平台）
- 猪八戒网（威客平台）
- 相关技术社区（V2EX、知乎等）

**推荐方案优先级：**

1. **办理全币种信用卡**（长期最佳方案）
2. **使用 PayPal + 储蓄卡**（无需信用卡）
3. **请朋友代付**（最快速）
4. **淘宝代付服务**（应急方案）
5. 虚拟信用卡（不推荐，成功率低）

**常见问题：**

- **支付被拒绝**: 尝试更换浏览器或清除缓存后重试
- **卡片验证失败**: 确认卡片已开通境外支付，联系银行确认
- **货币转换**: Google 会自动将 $5 转换为你的本地货币
- **PayPal 支付失败**: 确保 PayPal 账户已验证，余额充足或绑定的卡有效
- **虚拟卡被拒**: 虚拟卡成功率不稳定，建议改用信用卡或 PayPal

**注意**: 这是一次性费用，支付成功后可以永久发布扩展。

## 步骤 1: 创建 Google Cloud 项目

1. 访问 [Google Cloud Console](https://console.cloud.google.com/)
2. 创建新项目或选择现有项目
3. 记下项目 ID（示例）:
   - 项目名称: `your-project-name`
   - 项目编号: `123456789012`
   - 项目 ID: `your-project-id`

## 步骤 2: 启用 Chrome Web Store API

1. 在 Google Cloud Console 中，进入 "APIs & Services" > "Library"
2. 搜索 "Chrome Web Store API"
3. 点击启用

## 步骤 3: 创建 OAuth 2.0 凭证

1. 进入 "APIs & Services" > "Credentials"
2. 点击 "Create Credentials" > "OAuth client ID"
3. 如果提示配置同意屏幕，选择 "External" 并填写必要信息
4. 应用类型选择 "Web application"
5. 添加授权重定向 URI: `https://developers.google.com/oauthplayground`
6. 创建后，记下：
   - **Client ID**: `YOUR_CLIENT_ID.apps.googleusercontent.com`
   - **Client Secret**: `YOUR_CLIENT_SECRET`

## 步骤 3.5: 配置测试用户（重要）

如果你的扩展处于测试阶段，需要添加测试用户才能让其他人安装使用：

1. 在 Google Cloud Console 中，进入 "APIs & Services" > "OAuth consent screen"
2. 找到 "Test users" 部分
3. 点击 "ADD USERS"
4. 输入测试用户的 Gmail 地址（每行一个）
5. 点击 "SAVE"

**注意事项：**

- 测试用户必须使用 Gmail 账号
- 最多可以添加 100 个测试用户
- 只有添加的测试用户才能在扩展未发布时安装和使用
- 如果用户看到"此应用正在测试中"的提示，说明他们不在测试用户列表中

**发布到生产环境：**

- 当准备好公开发布时，需要提交 OAuth 同意屏幕进行 Google 验证
- 验证通过后，任何用户都可以安装你的扩展
- 验证过程可能需要几天到几周时间

## 步骤 4: 获取 Refresh Token

1. 访问 [OAuth 2.0 Playground](https://developers.google.com/oauthplayground/)
2. 点击右上角的设置图标（齿轮）
3. 勾选 "Use your own OAuth credentials"
4. 输入你的 Client ID 和 Client Secret
5. 在左侧 "Step 1" 中：
   - 找到 "Chrome Web Store API v1.1"
   - 选择 `https://www.googleapis.com/auth/chromewebstore`
6. 点击 "Authorize APIs"
7. 登录你的 Google 账号并授权
8. 在 "Step 2" 中，点击 "Exchange authorization code for tokens"
9. 记下 **Refresh Token**（示例响应）:

```json
{
  "access_token": "ya29.a0...",
  "refresh_token_expires_in": 604799,
  "expires_in": 3599,
  "token_type": "Bearer",
  "scope": "https://www.googleapis.com/auth/chromewebstore",
  "refresh_token": "1//04..."
}
```

**重要**: 保存 `refresh_token` 的值，这是你需要的 Refresh Token。

## 步骤 5: 获取 Extension ID

1. 访问 [Chrome Web Store Developer Dashboard](https://chrome.google.com/webstore/devconsole)
2. 找到你的扩展
3. Extension ID 显示在扩展名称下方（32 位字符串）
   - 示例: `abcdefghijklmnopqrstuvwxyz123456`

## 步骤 6: 配置 GitHub Secrets

1. 进入你的 GitHub 仓库
2. 点击 "Settings" > "Secrets and variables" > "Actions"
3. 点击 "New repository secret" 并添加以下 secrets：

| Secret Name            | 值                 | 说明       |
| ---------------------- | ------------------ | ---------- |
| `CHROME_CLIENT_ID`     | 你的 Client ID     | 来自步骤 3 |
| `CHROME_CLIENT_SECRET` | 你的 Client Secret | 来自步骤 3 |
| `CHROME_REFRESH_TOKEN` | 你的 Refresh Token | 来自步骤 4 |
| `CHROME_EXTENSION_ID`  | 你的 Extension ID  | 来自步骤 5 |

## 步骤 7: 测试自动发布

1. 更新 `package.json` 和 `src/manifest.json` 中的版本号
2. 提交更改并推送到 GitHub
3. 创建版本标签：
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```
4. GitHub Actions 将自动：
   - 构建扩展
   - 上传到 Chrome Web Store
   - 创建 GitHub Release

## 故障排查

### 错误: "Invalid refresh token"

- Refresh token 可能已过期
- 重新执行步骤 4 获取新的 refresh token

### 错误: "Extension not found"

- 检查 Extension ID 是否正确
- 确保扩展已在 Chrome Web Store 上发布过至少一次

### 错误: "Insufficient permissions"

- 确保 OAuth 凭证有正确的权限范围
- 重新授权并获取新的 refresh token

### 上传成功但未发布

- 检查 Chrome Web Store Developer Dashboard
- 可能需要手动审核或有其他问题

### 错误: "出于安全考虑，您必须为自己的账号启用两步验证"

- 你的 Google 账号未启用两步验证
- 按照"前提条件"部分的步骤启用两步验证
- 启用后刷新页面重试上传

### 错误: "此应用正在测试中，仅供已获开发者批准的测试人员使用"

- 用户不在 OAuth 同意屏幕的测试用户列表中
- 按照步骤 3.5 添加用户的 Gmail 地址到测试用户列表
- 或者提交 OAuth 同意屏幕进行 Google 验证以公开发布

## 安全注意事项

⚠️ **重要**:

- 永远不要将 secrets 提交到代码仓库
- 定期轮换 refresh token
- 只给必要的人员访问 GitHub secrets 的权限
- 监控 Chrome Web Store 的发布活动

## 手动发布（备选方案）

如果自动发布失败，你可以手动发布：

1. 运行 `pnpm build` 构建扩展
2. 将 `dist` 文件夹压缩为 zip
3. 访问 [Chrome Web Store Developer Dashboard](https://chrome.google.com/webstore/devconsole)
4. 上传 zip 文件
5. 填写更新说明并提交审核

## 参考资料

- [Chrome Web Store API 文档](https://developer.chrome.com/docs/webstore/api_index/)
- [chrome-webstore-upload 文档](https://github.com/fregante/chrome-webstore-upload)
- [Google OAuth 2.0 文档](https://developers.google.com/identity/protocols/oauth2)

## Firebase 配置（可选）

如果你的扩展使用 Firebase，需要配置 Firebase：

```bash
npm install firebase
```

```javascript
// Import the functions you need from the SDKs you need
import { initializeApp } from 'firebase/app'
import { getAnalytics } from 'firebase/analytics'

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: 'YOUR_API_KEY',
  authDomain: 'your-project.firebaseapp.com',
  projectId: 'your-project-id',
  storageBucket: 'your-project.firebasestorage.app',
  messagingSenderId: 'YOUR_SENDER_ID',
  appId: 'YOUR_APP_ID',
  measurementId: 'YOUR_MEASUREMENT_ID',
}

// Initialize Firebase
const app = initializeApp(firebaseConfig)
const analytics = getAnalytics(app)
```

**注意**: 将上述配置替换为你自己的 Firebase 项目配置。
